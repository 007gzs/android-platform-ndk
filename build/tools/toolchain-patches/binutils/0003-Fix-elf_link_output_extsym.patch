From 7024ae3b8248762eeaa5519c908e06c3f5da7655 Mon Sep 17 00:00:00 2001
From: Chao-ying Fu <fu@mips.com>
Date: Fri, 11 May 2012 14:59:39 -0700
Subject: [PATCH 2/2] Fix elf_link_output_extsym. Please check
 http://sourceware.org/bugzilla/show_bug.cgi?id=13311 .

---
 binutils-2.21/bfd/elflink.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/binutils-2.21/bfd/elflink.c b/binutils-2.21/bfd/elflink.c
index 6e92cc3..9c58507 100644
--- a/binutils-2.21/bfd/elflink.c
+++ b/binutils-2.21/bfd/elflink.c
@@ -8651,10 +8651,11 @@ elf_link_output_extsym (struct elf_link_hash_entry *h, void *data)
 
   /* We should also warn if a forced local symbol is referenced from
      shared libraries.  */
-  if (! finfo->info->relocatable
-      && (! finfo->info->shared)
+  if (!finfo->info->relocatable
+      && finfo->info->executable
       && h->forced_local
       && h->ref_dynamic
+      && h->def_regular
       && !h->dynamic_def
       && !h->dynamic_weak
       && ! elf_link_check_versioned_symbol (finfo->info, bed, h))
-- 
1.7.7.3

