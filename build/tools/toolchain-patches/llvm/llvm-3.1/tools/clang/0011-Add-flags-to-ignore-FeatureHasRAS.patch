From ab83cdfa980e7ce66ad2ff01cf5d13aa0a3e75e9 Mon Sep 17 00:00:00 2001
From: Logan Chien <loganchien@google.com>
Date: Wed, 5 Sep 2012 23:32:50 +0800
Subject: [PATCH 11/20] Add flags to ignore FeatureHasRAS.

---
 include/clang/Driver/Options.td |    2 ++
 lib/Driver/Tools.cpp            |    5 +++++
 2 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/include/clang/Driver/Options.td b/include/clang/Driver/Options.td
index b796771..6d138b0 100644
--- a/include/clang/Driver/Options.td
+++ b/include/clang/Driver/Options.td
@@ -650,6 +650,8 @@ def mno_fma4 : Flag<"-mno-fma4">, Group<m_x86_Features_Group>;
 def mno_thumb : Flag<"-mno-thumb">, Group<m_Group>;
 def marm : Flag<"-marm">, Alias<mno_thumb>;
 
+def mignore_has_ras : Flag<"-mignore-has-ras">;
+
 def mno_warn_nonportable_cfstrings : Flag<"-mno-warn-nonportable-cfstrings">, Group<m_Group>;
 def mno_omit_leaf_frame_pointer : Flag<"-mno-omit-leaf-frame-pointer">, Group<f_Group>;
 def momit_leaf_frame_pointer : Flag<"-momit-leaf-frame-pointer">, Group<f_Group>;
diff --git a/lib/Driver/Tools.cpp b/lib/Driver/Tools.cpp
index 80e3fcd..2958393 100644
--- a/lib/Driver/Tools.cpp
+++ b/lib/Driver/Tools.cpp
@@ -755,6 +755,11 @@ void Clang::AddARMTargetArgs(const ArgList &Args,
     if (A->getOption().matches(options::OPT_mno_global_merge))
       CmdArgs.push_back("-mno-global-merge");
   }
+
+  if (Args.hasArg(options::OPT_mignore_has_ras)) {
+    CmdArgs.push_back("-backend-option");
+    CmdArgs.push_back("-arm-ignore-has-ras");
+  }
 }
 
 // Get default architecture.
-- 
1.7.7.3

