From eafd7a194bf7a2fc2d4f8b1521cd68695f6026e0 Mon Sep 17 00:00:00 2001
From: Logan Chien <loganchien@google.com>
Date: Wed, 26 Sep 2012 14:21:35 +0800
Subject: [PATCH 1/3] Look for libraries in <install-dir>/bin/../lib

---
 llvm-3.1/tools/clang/lib/Driver/ToolChains.cpp |    2 ++
 llvm-3.1/tools/clang/test/Driver/linux-ld.c    |    2 ++
 2 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/llvm-3.1/tools/clang/lib/Driver/ToolChains.cpp b/llvm-3.1/tools/clang/lib/Driver/ToolChains.cpp
index fc7a818..df3ed67 100644
--- a/llvm-3.1/tools/clang/lib/Driver/ToolChains.cpp
+++ b/llvm-3.1/tools/clang/lib/Driver/ToolChains.cpp
@@ -2106,6 +2106,8 @@ Linux::Linux(const Driver &D, const llvm::Triple &Triple, const ArgList &Args)
   }
   addPathIfExists(SysRoot + "/lib", Paths);
   addPathIfExists(SysRoot + "/usr/lib", Paths);
+
+  addPathIfExists(getDriver().Dir + "/../lib", Paths);
 }
 
 bool Linux::HasNativeLLVMSupport() const {
diff --git a/llvm-3.1/tools/clang/test/Driver/linux-ld.c b/llvm-3.1/tools/clang/test/Driver/linux-ld.c
index 3d6a7e6..03c27d3 100644
--- a/llvm-3.1/tools/clang/test/Driver/linux-ld.c
+++ b/llvm-3.1/tools/clang/test/Driver/linux-ld.c
@@ -113,6 +113,7 @@
 // CHECK-INSTALL-DIR-32: "{{.*}}ld{{(.exe)?}}" "--sysroot=[[SYSROOT:[^"]+]]"
 // CHECK-INSTALL-DIR-32: "{{.*}}/Inputs/fake_install_tree/bin/../lib/gcc/i386-unknown-linux/4.7.0/crtbegin.o"
 // CHECK-INSTALL-DIR-32: "-L{{.*}}/Inputs/fake_install_tree/bin/../lib/gcc/i386-unknown-linux/4.7.0"
+// CHECK-INSTALL-DIR-32: "-L{{.*}}/Inputs/fake_install_tree/bin/../lib"
 //
 // Check that with 64-bit builds, we don't actually use the install directory
 // as its version of GCC is lower than our sysrooted version.
@@ -124,6 +125,7 @@
 // CHECK-INSTALL-DIR-64: "{{.*}}ld{{(.exe)?}}" "--sysroot=[[SYSROOT:[^"]+]]"
 // CHECK-INSTALL-DIR-64: "{{.*}}/usr/lib/gcc/x86_64-unknown-linux/4.6.0/crtbegin.o"
 // CHECK-INSTALL-DIR-64: "-L[[SYSROOT]]/usr/lib/gcc/x86_64-unknown-linux/4.6.0"
+// CHECK-INSTALL-DIR-64: "-L{{.*}}/Inputs/fake_install_tree/bin/../lib"
 //
 // Check that we support unusual patch version formats, including missing that
 // component.
-- 
1.7.7.3

